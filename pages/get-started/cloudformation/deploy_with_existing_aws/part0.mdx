# Part 0: Prerequisites

## 1. Configure your RDS database to allow ReadySet to follow updates to the primary database. 
First, check that the database’s current parameter group has binlog_format set to `ROW`.
In the RDS console for the database, click the Configuration tab and then the Parameter group. 
In the parameters screen, filter by `binlog_format` and verify it is `ROW`. If it isn’t, edit the parameter group.

Then, check that the backup retention period for the database is not `0`. If your backup retention period is `0`, set 
it to any integer (e.g. `1`).

To check your backup retention period, navigate to the RDS Console for the database, click the Maintenance & 
Backup tab and then see if Automated Backups are enabled. If they aren’t enabled, click the Modify button on 
the database page to set the Backup Retention Period to at least 1 day. 

> **Note:** During the ReadySet server DB snapshotting process, all tables will undergo a full table lock, so new writes will 
> be blocked until the snapshot completes. If your DB needs to be writeable during this time, we recommend creating a new RDS 
> snapshot of the desired instance, or use last night's snapshot (if you have automated backups enabled) to create a new DB 
> instance for the test.

## 2. Configure your VPC for high availability and access. 
Confirm that your VPC has exactly 3 private subnets in different availability zones. This ensures that ReadySet is able 
to handle intermittent AWS instance failures. This can be found by filtering the Subnets list in the VPC console by the VPC 
ID and verifying the availability zones.

Then, check that there is a security group that is configured to allow SSH traffic. Instances will later be attached to this 
security group to allow direct host access.

## 3. Make sure you have a EC2 SSH Key set up for accessing the various instances that will be created.
Copy the name of the key for use in the next step and in Part 1.

## 4. Ensure that your current Consul cluster can connect to ReadySet or set up a new Consul cluster. 
ReadySet requires a Consul cluster to operate correctly. If you have an existing Consul cluster you would like to use, go to 4a. 
Otherwise, go to 4b.
### a. If you have an existing Consul cluster you would like to use, make sure that your existing Consul cluster can be used by ReadySet:
Check that it can be found using the retry-join feature. Create an IAM Managed Policy which has the `ec2:DescribeInstances` permission to find instances for retry-join. Copy this `IAMManagedPolicyARN` for use in Part 1.

### b. If you don’t already have a Consul cluster, then you can set one up by launching this ReadySet-provided Consul stack. 
**Step 1: Specify Template**

The first page should already be pre-configured for you. You can just click Next at the bottom of the page.

**Step 2: Specify Stack Details**

Fill in the fields that using the instructions below. 
| Parameter      | Guidance |
| ----------- | ----------- |
| `Stack name` | You will be creating another ReadySet stack in Part 1, so we recommend naming your stack something like "ReadySetConsul".  |
| `BastionSecurityGroupID` | This should be a security group that will be added to all Consul instances for access. |
| `KeyPairName` | Paste in the name of the key you copied from Part 0 Step 3. |
| `VPCID`   | This should be the ID of the VPC that will have  Consul and ReadySet installed.  |
| `VPCCIDR` | Copy the CIDR from the VPC provided in VPCID. To find the CIDR, navigate to the VPC console, find the row corresponding to your selected VPCID, and copy the CIDR.|
| `PrivateSubnet<1, 2, 3>ID` | Fill in the IDs of the subnets referenced in Part 0 Step 2. |

**Step 3: Configure Stack Options**

Fill in your desired stack options. We highly recommend selecting "Preserve successfully provisioned resources" to allow ReadySet to help debug deployment issues that may arise.
These options are dependent on your company's AWS security policies. We currently do not have a list of all IAM permissions required to deploy these stacks. 

**Step 4: Review**

This page provides a review of your Consul setup configurations. You must accept the Capabilities acknowledgement before creating your stack.
Once the stack has reached the `CREATE_COMPLETED` state, copy the `ConsulJoinManagedPolicy` output and provide it as the `ConsulJoinManagedPolicyArn` input as a part of launching this stack.